<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Performance Predictor</title>

  <!-- Bootstrap 5 via CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <style>
    body { background: #0f172a; /* slate-900 */ }
    .card { border: 0; border-radius: 1rem; }
    .brand { font-weight: 800; letter-spacing: 0.3px; }
    .glass {
      background: rgba(255,255,255,0.04);
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .form-label { font-weight: 600; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-7">
        <div class="card glass text-white">
          <div class="card-body p-4 p-md-5">
            <h1 class="brand mb-1">ðŸŽ“ Student Performance Predictor</h1>
            <p class="text-secondary mb-4">Predict next percentage from Attendance% and CGPA%, then see the category & message.</p>

            <form id="predictForm" class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="studentName">Student Name</label>
                <input class="form-control" id="studentName" placeholder="e.g., Aisha Khan" />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="registerNo">Register No.</label>
                <input class="form-control" id="registerNo" placeholder="e.g., REG0123" />
              </div>

              <div class="col-md-6">
                <label class="form-label" for="attendance">Attendance (%)</label>
                <input type="number" class="form-control" id="attendance" min="0" max="100" step="0.1" required placeholder="0â€“100" />
                <div class="form-text">Enter percentage. Example: 88.5</div>
              </div>

              <div class="col-md-6">
                <label class="form-label" for="cgpaPercentage">CGPA (as % or on 10)</label>
                <input type="number" class="form-control" id="cgpaPercentage" min="0" max="100" step="0.1" required placeholder="e.g., 7.8 or 78" />
                <div class="form-text">If CGPA is on 10-point scale, enter like 7.8 (weâ€™ll auto-convert).</div>
              </div>

              <div class="col-12 d-grid d-sm-flex gap-2">
                <button id="predictBtn" class="btn btn-primary btn-lg px-4" type="submit">
                  Predict
                </button>
                <button id="resetBtn" class="btn btn-outline-light btn-lg px-4" type="button">
                  Reset
                </button>
              </div>
            </form>

            <div id="result" class="mt-4" style="display:none;">
              <div class="alert" id="resultAlert" role="alert"></div>

              <div class="card glass mt-3">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Predicted Next Percentage</h5>
                    <span class="badge rounded-pill text-bg-secondary" id="categoryBadge">â€”</span>
                  </div>
                  <div class="progress mt-3" role="progressbar" aria-label="Predicted percentage"
                       aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar" id="progressBar" style="width: 0%;">0%</div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-sm-6">
                      <small class="text-secondary d-block">Inputs</small>
                      <div class="mt-1">
                        <span class="d-block">Attendance: <strong id="attOut">â€”</strong></span>
                        <span class="d-block">CGPA%: <strong id="cgpaOut">â€”</strong></span>
                      </div>
                    </div>
                    <div class="col-sm-6 text-sm-end">
                      <small class="text-secondary d-block">Student</small>
                      <div class="mt-1">
                        <span class="d-block"><strong id="nameOut">â€”</strong></span>
                        <span class="d-block"><span id="regOut">â€”</span></span>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <div id="spinner" class="text-center mt-4" style="display:none;">
              <div class="spinner-border" role="status" aria-hidden="true"></div>
              <div class="mt-2">Predictingâ€¦</div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS bundle (with Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

  <script>
    const form = document.getElementById("predictForm");
    const predictBtn = document.getElementById("predictBtn");
    const resetBtn = document.getElementById("resetBtn");
    const spinner = document.getElementById("spinner");
    const result = document.getElementById("result");
    const resultAlert = document.getElementById("resultAlert");
    const progressBar = document.getElementById("progressBar");
    const categoryBadge = document.getElementById("categoryBadge");

    const attOut = document.getElementById("attOut");
    const cgpaOut = document.getElementById("cgpaOut");
    const nameOut = document.getElementById("nameOut");
    const regOut = document.getElementById("regOut");

    function setResultVisible(show) {
      result.style.display = show ? "block" : "none";
    }
    function setSpinner(show) {
      spinner.style.display = show ? "block" : "none";
    }
    function categoryClass(cat) {
      switch (cat) {
        case "High": return "alert-success";
        case "Average": return "alert-primary";
        case "Low": return "alert-warning";
        default: return "alert-danger";
      }
    }
    function badgeClass(cat) {
      switch (cat) {
        case "High": return "text-bg-success";
        case "Average": return "text-bg-primary";
        case "Low": return "text-bg-warning";
        default: return "text-bg-danger";
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const studentName = document.getElementById("studentName").value.trim();
      const registerNo = document.getElementById("registerNo").value.trim();
      const attendance = parseFloat(document.getElementById("attendance").value);
      const cgpaPercentage = parseFloat(document.getElementById("cgpaPercentage").value);

      if (isNaN(attendance) || isNaN(cgpaPercentage)) return;

      setSpinner(true);
      setResultVisible(false);
      resultAlert.className = "alert";

      try {
        const res = await fetch("/api/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ studentName, registerNo, attendance, cgpaPercentage })
        });
        const data = await res.json();

        // Update UI
        const pct = data.predicted_percentage ?? 0;
        const cat = data.category ?? "â€”";
        const msg = data.message ?? "";

        resultAlert.textContent = msg;
        resultAlert.classList.add(categoryClass(cat));
        categoryBadge.textContent = cat;
        categoryBadge.className = "badge rounded-pill " + badgeClass(cat);

        progressBar.style.width = pct + "%";
        progressBar.textContent = pct + "%";

        attOut.textContent = data.inputs?.attendance + "%";
        cgpaOut.textContent = data.inputs?.cgpa_percentage + "%";
        nameOut.textContent = data.studentName || "â€”";
        regOut.textContent = data.registerNo || "â€”";

        setResultVisible(true);
      } catch (err) {
        resultAlert.textContent = "Something went wrong. Please try again.";
        resultAlert.classList.add("alert-danger");
        setResultVisible(true);
      } finally {
        setSpinner(false);
      }
    });

    resetBtn.addEventListener("click", () => {
      form.reset();
      setResultVisible(false);
    });
  </script>
</body>
</html>
